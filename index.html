<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>PortionCal – Calorie Portion Calculator</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<style>
body {
  font-family: system-ui, Arial, sans-serif;
  margin: 20px;
  background:#fafafa;
  line-height: 1.5;
}

h1 {
  margin-bottom: 0.2em;
}

.container {
  max-width: 760px;
  margin: auto;
  background: white;
  padding: 16px 20px;
  border-radius: 12px;
  box-shadow: 0 2px 14px rgba(0,0,0,.06);
}

.section {
  margin-top: 18px;
  padding-top: 10px;
  border-top: 1px solid #eee;
}

label {
  font-weight: 600;
}

input {
  width: 100%;
  padding: 8px;
  margin-top: 4px;
  margin-bottom: 10px;
  font-size: 1rem;
}

button {
  padding: 8px 14px;
  font-size: 0.95rem;
  cursor: pointer;
}

.pan-list {
  display: flex;
  gap: 12px;
  flex-wrap: wrap;
}

.pan {
  border: 2px solid #ccc;
  padding: 10px;
  border-radius: 10px;
  cursor: pointer;
  text-align: center;
  width: 110px;
  background:#f4f4f4;
}

.pan img {
  width: 90px;
  height: 90px;
  object-fit: contain;
  display: block;
  margin: 0 auto 6px auto;
}

.pan.selected {
  border-color: #0077ff;
  background: #e9f0ff;
}

.hidden {
  display:none;
}

.result-box {
  background: #f1f9ff;
  border: 1px solid #cfe8ff;
  padding: 10px;
  border-radius: 8px;
  font-size: 1.1rem;
}

.small {
  opacity: .8;
  font-size: .9rem;
}
</style>
</head>

<body>
<div class="container">

<h1>PortionCal</h1>
<div class="small">Calorie calculator for shared home-cooked meals</div>

<!-- PAN SELECTION -->
<div class="section">
  <h3>1) Select pan / pot</h3>

  <div id="panListMain" class="pan-list"></div>
  <br>

  <button id="moreButton" onclick="toggleMore()">Show more pans</button>

  <div id="morePans" class="pan-list hidden" style="margin-top:10px;"></div>

  <label>Selected pan empty weight (grams)</label>
  <input type="number" id="panWeight" disabled />
  <button id="saveButton" onclick="saveCustomWeight()" disabled>Save custom weight</button>
  <div class="small">Only the “Custom” pan can be edited.</div>
</div>

<!-- DISH INPUTS -->
<div class="section">
  <h3>2) Enter dish totals</h3>

  <label>Total weight on scale (pan + food, grams):</label>
  <input type="number" id="totalWeight"/>

  <label>Total calories of cooked dish:</label>
  <input type="number" id="totalCalories"/>

  <button onclick="calculateBase()">Calculate calories per gram</button>

  <div class="result-box" id="baseOutput"></div>
</div>

<!-- SERVING CALCULATORS -->
<div class="section">
  <h3>3) Portion calculations</h3>

  <label>Desired calories → get serving weight (grams)</label>
  <input type="number" id="targetCalories" oninput="calcTargetWeight()"/>

  <label>Serving weight (grams) → get calories</label>
  <input type="number" id="servingWeight" oninput="calcServingCalories"/>

  <div class="result-box" id="portionOutput"></div>
</div>

</div>

<script>
/* ---------- PAN DEFINITIONS ---------- */

/* load saved custom weight or default */
let customWeight = Number(localStorage.getItem("customPanWeight")) || 1000;

/* 5 main pans */
const pansMain = [
  {name:"Pan S", weight:635, img:"media/small_pan.jpg"},
  {name:"Pan M", weight:756, img:"media/smallish_pan.jpg"},
  {name:"Pan L", weight:5000, img:"media/medium_pan.jpg"},
  {name:"Pan XL", weight:1548, img:"media/huge_pan.jpg"},
  {name:"Frypan M", weight:973, img:"media/medium_frypan.jpg"}
];

/* expandable 5 more pans (last is custom) */
const pansMore = [
  {name:"Frypan S", weight:799, img:"media/tiny_frypan.jpg"},
  {name:"Frypan L",  weight:1301, img:"media/huge_frypan.jpg"},
  {name:"other pan", weight:0, img:"media/largepot.png"},
  {name:"other pan pan", weight:0, img:"media/smallpan.png"},
  {name:"Custom", weight:customWeight, custom:true, img:"media/custom.png"}
];

let selected = { group:"main", index:0 };

function renderPans() {

  const main = document.getElementById("panListMain");
  const more = document.getElementById("morePans");

  main.innerHTML = "";
  more.innerHTML = "";

  /* main group */
  pansMain.forEach((p,i)=>{
    const d=document.createElement("div");
    d.className="pan"+(selected.group==="main" && selected.index===i ? " selected":"");
    d.innerHTML=
      `<img src="${p.img}" alt="${p.name}">`+
      `<strong>${p.name}</strong><br>${p.weight} g`;
    d.onclick=()=>selectPan("main",i);
    main.appendChild(d);
  });

  /* ensure custom weight reflects latest */
  pansMore[4].weight = customWeight;

  /* more group */
  pansMore.forEach((p,i)=>{
    const d=document.createElement("div");
    d.className="pan"+(selected.group==="more" && selected.index===i ? " selected":"");
    d.innerHTML=
      `<img src="${p.img}" alt="${p.name}">`+
      `<strong>${p.name}</strong><br>${p.weight} g`;
    d.onclick=()=>selectPan("more",i);
    more.appendChild(d);
  });

  updateWeightPanel();
}

function toggleMore(){
  const el = document.getElementById("morePans");
  el.classList.toggle("hidden");
  document.getElementById("moreButton").innerText =
    el.classList.contains("hidden") ? "Show more pans" : "Hide extra pans";
}

function selectPan(group,index){
  selected = {group,index};
  renderPans();
}

function getSelectedPan(){
  return selected.group==="main"
    ? pansMain[selected.index]
    : pansMore[selected.index];
}

/* ---------- EDIT PANEL BEHAVIOR ---------- */

function updateWeightPanel(){
  const pan=getSelectedPan();
  const input=document.getElementById("panWeight");
  const saveBtn=document.getElementById("saveButton");

  if(pan.custom){
    input.disabled=false;
    saveBtn.disabled=false;
    input.value=customWeight;
  } else {
    input.disabled=true;
    saveBtn.disabled=true;
    input.value=pan.weight;
  }
}

/* Only custom pan can save */
function saveCustomWeight(){
  const v=Number(document.getElementById("panWeight").value);
  if(!v || v<=0){
    alert("Enter valid custom pan weight");
    return;
  }
  customWeight=v;
  localStorage.setItem("customPanWeight", v);
  renderPans();
}

/* ---------- BASE CALCULATION ---------- */

let caloriesPerGram=null;

function calculateBase(){
  const totalWeight=Number(document.getElementById("totalWeight").value);
  const totalCalories=Number(document.getElementById("totalCalories").value);
  const pan=getSelectedPan();
  const panWeight=pan.custom ? customWeight : pan.weight;

  if(!totalWeight || !totalCalories){
    alert("Please enter totals");
    return;
  }

  const foodWeight=totalWeight - panWeight;
  if(foodWeight<=0){
    alert("Food weight must be positive after subtracting pan weight");
    return;
  }

  caloriesPerGram = totalCalories / foodWeight;

  document.getElementById("baseOutput").innerHTML =
    `Total food weight: <b>${foodWeight.toFixed(1)} g</b><br>
     Calories per gram: <b>${caloriesPerGram.toFixed(4)}</b><br>
     Calories per 100 g: <b>${(caloriesPerGram*100).toFixed(0)}</b>`;

  document.getElementById("portionOutput").innerHTML="";
}

/* ---------- TARGET CALCULATIONS ---------- */

function calcTargetWeight(){
  if(!caloriesPerGram){
    document.getElementById("portionOutput").innerHTML="First calculate calories per gram above.";
    return;
  }
  const target=Number(document.getElementById("targetCalories").value);
  if(!target){
    document.getElementById("portionOutput").innerHTML="";
    return;
  }
  const gramsNeeded = target / caloriesPerGram;
  document.getElementById("portionOutput").innerHTML =
    `To eat <b>${target}</b> kcal, serve <b>${gramsNeeded.toFixed(1)} g</b>`;
}

function calcServingCalories(){
  if(!caloriesPerGram){
    document.getElementById("portionOutput").innerHTML="First calculate calories per gram above.";
    return;
  }
  const grams=Number(document.getElementById("servingWeight").value);
  if(!grams){
    document.getElementById("portionOutput").innerHTML="";
    return;
  }
  const kcals = grams * caloriesPerGram;
  document.getElementById("portionOutput").innerHTML =
    `${grams.toFixed(1)} g contains about <b>${kcals.toFixed(0)} kcal</b>`;
}

/* initial render */
renderPans();
</script>

</body>
</html>

